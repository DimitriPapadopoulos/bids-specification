#
# Groups of related metadata fields
#
# Assumptions: never need disjunction of selectors
# Assumptions: top-to-bottom overrides is sufficient logic

---
# MRS Common metadata fields
MRSScannerHardware:
  selectors:
    - modality == "mrs"
  fields:
    InstitutionName: recommended
    InstitutionAddress: recommended
    InstitutionalDepartmentName: recommended
    Manufacturer: recommended
    ManufacturersModelName: recommended
    DeviceSerialNumber: recommended
    StationName: recommended
    SoftwareVersions: recommended
    MagneticFieldStrength: recommended
    ReceiveCoilName: recommended
    ReceiveCoilActiveElements: recommended
    NumberReceiveCoilActiveElements: optional
    NumberTransmitCoilActiveElements: optional

MRSSample:
  selectors:
    - modality == "mrs"
  fields:
    BodyPart:
      level: optional
      description_addendum: Corresponds to DICOM Tag 0018, 0015 `Body Part Examined`.
    BodyPartDetails: optional
    BodyPartDetailsOntology: optional

MRSSequenceSpecifics:
  selectors:
    - modality == "mrs"
  fields:
    PulseSequenceType:
      level: recommended
      description_addendum: |
        For example, `"sLASER"`, `"MEGA-PRESS"`, `"EPSI"`, `"Metabolite-cycled MRSI"`.
    ScanningSequence__mrs: recommended
    SequenceName: recommended
    PulseSequenceDetails: recommended
    WaterSuppression: recommended
    WaterSuppressionTechnique: optional
    OuterVolumeSuppression: optional
    B0ShimmingTechnique: optional
    B1ShimmingTechnique: optional

MRSRequiredFields:
  selectors:
    - modality == "mrs"
  fields:
    ResonantNucleus: required
    SpectrometerFrequency: required
    SpectralWidth: required
    EchoTime: required

MRSRecommendedFields:
  selectors:
    - modality == "mrs"
  fields:
    NumberOfSpectralPoints: recommended
    RepetitionTime__mrs: recommended
    MixingTime: recommended
    InversionTime: recommended for inversion recovery data
    FlipAngle: recommended
    AcquisitionVoxelSize: recommended
    MatrixSize: recommended for MRSI
    VolumeAffineMatrix: recommended for MRSI
    EncodingTechnique: recommended for MRSI

MRSRecommendedFieldsAnatomicalImage:
  selectors:
    - modality == "mrs"
    - intersects(dataset.datatypes, ["anat"])
  fields:
    AnatomicalImage:
      level: recommended
      level_addendum: if anatomical MRI data are present

MRSRecommendedFieldsNumTransients:
  selectors:
    - modality == "mrs"
    - intersects([suffix], ["svs", "unloc"])
  fields:
    NumberOfTransients: recommended

MRSRecommendedFieldsRefSignal:
  selectors:
    - modality == "mrs"
    - intersects([suffix], ["mrsref"])
  fields:
    ReferenceSignal:
      level: recommended
      level_addendum: if MRS reference data are present

MRSIRecommendedFields:
  selectors:
    - modality == "mrs"
    - suffix == "mrsi"
  fields:
    MRAcquisitionType:
      level: recommended
      level_addendum: for MRSI

MRSOptionalFields:
  selectors:
    - modality == "mrs"
  fields:
    ChemicalShiftOffset: optional
    ChemicalShiftReference: optional
    EditTarget: optional
    EditPulse: optional
    EditCondition: optional
    EchoAcquisition: optional
    ParallelReductionFactorInPlane: optional
    ParallelAcquisitionTechnique: optional
    MultibandAccelerationFactor: optional
    PulseSequenceTiming: optional
    PulseSequencePulses: optional
    ReceiveGain: optional
