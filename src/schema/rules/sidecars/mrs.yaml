#
# Groups of related metadata fields
#
# Assumptions: never need disjunction of selectors
# Assumptions: top-to-bottom overrides is sufficient logic

---
# MRS Common metadata fields
MRSScannerHardware:
  selectors:
    - modality == "mrs"
  fields:
    InstitutionName: recommended
    InstitutionAddress: recommended
    InstitutionalDepartmentName: recommended
    Manufacturer: recommended
    ManufacturersModelName: recommended
    DeviceSerialNumber: recommended
    StationName: recommended
    SoftwareVersions: recommended
    MagneticFieldStrength: recommended
    ReceiveCoilName: recommended
    ReceiveCoilActiveElements: recommended
    NumberReceiveCoilActiveElements: recommended

MRSSample:
  selectors:
    - modality == "mrs"
  fields:
    BodyPart:
      level: optional
      description_addendum: Corresponds to DICOM Tag 0018, 0015 `Body Part Examined`.
    BodyPartDetails: optional
    BodyPartDetailsOntology: optional

MRSSequenceSpecifics:
  selectors:
    - modality == "mrs"
  fields:
    PulseSequenceType:
      level: recommended
      description_addendum: |
        For example, `"sLASER"`, `"MEGA-PRESS"`, `"EPSI"`, `"Metabolite-cycled MRSI"`.
    ScanningSequence__mrs: recommended
    SequenceName: recommended
    PulseSequenceDetails: recommended
    MRAcquisitionType: recommended for MRSI

MRSRequiredFields:
  selectors:
    - modality == "mrs"
  fields:
    ResonantNucleus: required
    SpectrometerFrequency: required
    SpectralWidth: required
    EchoTime: required

MRSRecommendedFields:
  selectors:
    - modality == "mrs"
  fields:
    NumberOfSpectralPoints: recommended
    NumberOfTransients:
      level: optional
      level_addendum: recommended for SVS and unloc
    RepetitionTime__mrs: recommended
    MixingTime: recommended
    InversionTime: recommended for inversion recovery data
    FlipAngle: recommended
    AcquisitionVoxelSize: recommended
    MatrixSize: recommended for MRSI
    VolumeAffineMatrix: recommended for MRSI
    EditTarget: recommended for edited data
    EditPulse: recommended for edited data
    EditCondition: recommended for edited data
    WaterSuppression: recommended
    WaterSuppressionTechnique: recommended
    OuterVolumeSuppression: recommended
    EncodingTechnique: recommended for MRSI
    B0ShimmingTechnique: recommended
    ReferenceSignal: recommended if MRS reference data are present
    AnatomicalImage: recommended if anatomical MRI data are present

NumberOfTransientsRecommended:
  selectors:
    - datatype == "mrs"
    - intersects([suffix], ["svs", "unloc"])
  fields:
    NumberOfTransients: recommended

MRSOptionalFields:
  selectors:
    - modality == "mrs"
  fields:
    ChemicalShiftOffset: optional
    ChemicalShiftReference: optional
    EchoAcquisition: optional
    ParallelReductionFactorInPlane: optional
    ParallelAcquisitionTechnique: optional
    MultibandAccelerationFactor: optional
    NumberTransmitCoilActiveElements: optional
    B1ShimmingTechnique: optional
    PulseSequenceTiming: optional
    PulseSequencePulses: optional
    ReceiveGain: optional
